bed <- "/lab/alicia/scATAC/00_test_run_processed//04_motifProcessing/peakCalls_singles/GM12878_summits.flt.500bp.top50k.annotate.bed"
library(chromVAR)
peaks <- get_peaks(bed)
seqs <- Biostrings::getSeq(BSgenome.Hsapiens.UCSC.hg19::BSgenome.Hsapiens.UCSC.hg19, peaks)
#get nucleotide frequencies
nucFreqs <-  chromVAR:::get_nuc_freqs(seqs)
seqs <- as.character(seqs)
motifs <- get_motifs()
motif_ix <- get_motif_indices(motifs = motifs, peaks = peaks)
motif_mats <- lapply(do.call(TFBSTools::PWMatrixList,lapply(motifs, TFBSTools::toPWM)),
function(x) TFBSTools::as.matrix(x))
library(MOODSR)
test <- MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7)
dim(test)
sum(test[,1])
length(motif_ix[[1]])
length(motif_ix[[2]])
sum(test[,2])
test <- MOODSR:::get_motif_ix(motif_mats,seqs,
nucFreqs,
0.00005,
7)
dim(test)
sum(test[,117])
length(motif_ix[[117]])
all.equal(which(test[,117] == 1),motif_ix[[117]] )
all.equal(which(test[,10] == 1),motif_ix[[10]] )
microbenchmark(m3 = MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7),m6 = MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7), times = 1)
require(microbenchmark)
microbenchmark(m3 = MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7),m6 = MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7), times = 1)
microbenchmark(m3 = MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7),m6 = MOODSR:::get_motif_ix(motif_mats[1:6],seqs,
nucFreqs,
0.00005,
7), times = 1)
microbenchmark(m3 = MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7),m15 = MOODSR:::get_motif_ix(motif_mats[1:15],seqs,
nucFreqs,
0.00005,
7), times = 1)
3 * 117/15
microbenchmark(m117 = MOODSR:::get_motif_ix(motif_mats,seqs,
nucFreqs,
0.00005,
7), times = 1)
microbenchmark(old = get_motif_indices(motifs = motifs, peaks = peaks) , times = 1)
BiocParallel::register(BiocParallel::MulticoreParam(16))
microbenchmark(old = get_motif_indices(motifs = motifs, peaks = peaks) , times = 1)
223/16
microbenchmark(m50 = MOODSR:::get_motif_ix(motif_mats[1:50],seqs,
nucFreqs,
0.00005,
7), times = 1)
lineprof::lineprof(MOODSR:::get_motif_ix(motif_mats[1:50],seqs,
+                                                             nucFreqs,
+                                                             0.00005,
+                                                             7))
library(MOODSR)
test <- MOODSR:::get_motif_ix(motif_mats[1:3],seqs,
nucFreqs,
0.00005,
7)
library(MOODSR)
test <- MOODSR:::get_motif_ix(motif_mats[1:3],seqs[1:3],
nucFreqs,
0.00005,
7)
library(MOODSR)
test <- MOODSR:::get_motif_ix(motif_mats[1:3],seqs[1:3],
nucFreqs,
0.00005,
7)
4.1192e-05
4.1192e-05*50000
4.1192e-05*50000/3
test <- MOODSR:::get_motif_ix(motif_mats[1:10],seqs[1:3],
nucFreqs,
0.00005,
7)
test <- MOODSR:::get_motif_ix(motif_mats[1:100],seqs[1:3],
nucFreqs,
0.00005,
7)
load("/lab/alicia/chromVAR_applications/motif_data_from_jdb/cisbp_motifs.v4.RData")
pwms[1]
motif_mats2 <- lapply(pwms, TFBSTools::as.matrix(x))
motif_mats2 <- lapply(pwms, TFBSTools::as.matrix)
motif_mats2[1]
motif_mats2[2]
test2 <- MOODSR:::get_motif_ix(motif_mats2,seqs[1:10],
nucFreqs,
0.00005,
7)
test2[1:3]
0.007*100,000
0.007*100000
0.007*500000
0.007*500000/60
?RcppParallel
??RcppParallel
